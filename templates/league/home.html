<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Prediction League</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.8/css/dataTables.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/2.0.8/js/dataTables.min.js"></script>
    <style>
        body {
            font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
            margin: 24px;
            background: #f6f8fa;
        }

        .hero {
            background: linear-gradient(135deg, #111 0%, #2e86de 100%);
            color: #fff;
            border-radius: 16px;
            padding: 28px 24px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, .15);
        }

        .hero h1 {
            margin: 0 0 8px 0;
            font-weight: 700;
            letter-spacing: .2px;
        }

        .hero p {
            margin: 0;
            opacity: .9;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        @media (min-width: 980px) {
            .grid {
                grid-template-columns: 1fr 1fr 1fr;
            }
        }

        .card {
            background: #fff;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, .06);
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .header h2 {
            margin: 0;
            font-size: 18px;
        }

        a {
            color: #0366d6;
            text-decoration: none;
        }

        .user-cell {
            line-height: 1.2;
        }

        .user-cell .u {
            font-weight: 700;
            font-size: 15px;
        }

        .user-cell .t {
            color: #666;
            opacity: .8;
            font-size: 13px;
        }

        .pundit-row {
            background: #f0ecc7 !important;
        }

        .site-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin: 16px 0;
        }

        .site-header a {
            font-weight: 600;
        }

        table.dataTable tbody tr:hover {
            background: #f7f7f7;
        }
    </style>
    <script>
        async function loadHome() {
            // Current leaderboard (top 10) - correct-based
            const cur = await fetch('/api/standings/current/');
            const curJson = await cur.json();
            const byCorrect = [...(curJson.results || [])].sort((a, b) => {
                const ac = (a.curr_rank_correct_based || 9999), bc = (b.curr_rank_correct_based || 9999);
                return ac - bc;
            });
            const currBody = document.querySelector('#curr-correct tbody');
            currBody.innerHTML = '';
            byCorrect.slice(0, 10).forEach(r => {
                const tr = document.createElement('tr');
                const isPundit = r.player_type === 'pundit';
                const icon = isPundit ? ' <span title="Pundit">⭐</span>' : '';
                const userLink = `<a href="/api/page/u/${encodeURIComponent(r.username)}/">${r.username}</a>${icon}`;
                const userTeamCell = `<div class="user-cell"><div class="u">${userLink}</div><div class="t">${r.team_name ? r.team_name : ''}</div></div>`;
                tr.innerHTML = `<td>${r.curr_rank_correct_based || '-'}</td><td>${userTeamCell}</td><td>${r.score_correct}</td>`;
                if (isPundit) tr.classList.add('pundit-row');
                currBody.appendChild(tr);
            });
            new DataTable('#curr-correct', { paging: false, searching: false, info: false });

            // Deviation leaderboard (top 10) - low is better
            const byDeviation = [...(curJson.results || [])].sort((a, b) => {
                const ad = (a.curr_rank_deviation_based || 9999), bd = (b.curr_rank_deviation_based || 9999);
                return ad - bd;
            });
            const devBody = document.querySelector('#curr-dev tbody');
            devBody.innerHTML = '';
            byDeviation.slice(0, 10).forEach(r => {
                const tr = document.createElement('tr');
                const isPundit = r.player_type === 'pundit';
                const icon = isPundit ? ' <span title="Pundit">⭐</span>' : '';
                const userLink = `<a href="/api/page/u/${encodeURIComponent(r.username)}/">${r.username}</a>${icon}`;
                const userTeamCell = `<div class="user-cell"><div class="u">${userLink}</div><div class="t">${r.team_name ? r.team_name : ''}</div></div>`;
                tr.innerHTML = `<td>${r.curr_rank_deviation_based || '-'}</td><td>${userTeamCell}</td><td>${r.score_deviation}</td>`;
                if (isPundit) tr.classList.add('pundit-row');
                devBody.appendChild(tr);
            });
            new DataTable('#curr-dev', { paging: false, searching: false, info: false });

            // Live PL table (top 10)
            const pl = await fetch('/api/standings/pl/');
            const plJson = await pl.json();
            const plBody = document.querySelector('#pl tbody');
            plBody.innerHTML = '';
            plJson.slice(0, 10).forEach(t => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${t.position}</td><td>${t.name}</td>`;
                plBody.appendChild(tr);
            });
            new DataTable('#pl', { paging: false, searching: false, info: false });
        }
        document.addEventListener('DOMContentLoaded', loadHome);
    </script>
</head>

<body>
    <div class="site-header">
        <a href="/">Home</a>
        <a href="/api/page/current/">Current Standings</a>
        <a href="/api/page/pl/">PL Table</a>
    </div>
    <div class="hero">
        <h1>Prediction League</h1>
        <p>Follow the season, track your predictions, and climb the leaderboard.</p>
    </div>
    <div class="grid">
        <div class="card">
            <div class="header">
                <h2>Leaderboard (Correct)</h2>
                <a href="/api/page/current/">View all</a>
            </div>
            <table id="curr-correct" class="display" style="width:100%">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>User / Team</th>
                        <th>Correct</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        <div class="card">
            <div class="header">
                <h2>Leaderboard (Deviation)</h2>
                <a href="/api/page/current/">View all</a>
            </div>
            <table id="curr-dev" class="display" style="width:100%">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>User / Team</th>
                        <th>Deviation</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        <div class="card">
            <div class="header">
                <h2>Premier League (Live)</h2>
                <a href="/api/page/pl/">Full table</a>
            </div>
            <table id="pl" class="display" style="width:100%">
                <thead>
                    <tr>
                        <th>Pos</th>
                        <th>Team</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</body>

</html>